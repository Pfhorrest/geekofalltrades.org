{
  "name": "geekofalltrades",
  "version": "1.0.0",
  "private": true,
  "devDependencies": {
    "@vitest/coverage-v8": "^4.0.15",
    "concurrently": "latest",
    "npm-run-all": "^4.1.5",
    "sass": "latest",
    "sassdoc": "^1.10.12",
    "typedoc": "^0.28.14",
    "typescript": "latest",
    "vitest": "^4.0.15"
  },
  "scripts": {
    "process:photos": "cd photos && . process_photos/.venv/bin/activate && python3 -m process_photos && deactivate && cd ..",
    "dev:sass-watch": "sass --watch __styles/styles.scss:__styles/styles.css",
    "dev:ts-watch": "tsc --watch",
    "dev:php-server": "php -S geekofalltrades.local:8000 -t . ___structure/http.php",
    "dev:load-tab": "bash -c 'while ! nc -z geekofalltrades.local 8000; do sleep 0.5; done; open \"http://geekofalltrades.local:8000\"; while true; do fswatch -1 __styles __scripts *.php; done'",
    "dev": "concurrently -k -n SASS,TS,PHP,LOAD -c magenta,yellow,blue,green, \"npm run dev:sass-watch\" \"npm run dev:ts-watch\" \"npm run dev:php-server\" \"npm run dev:load-tab\"",
    "test:php": "php vendor/bin/phpunit --display-warnings --display-notices",
    "test:js": "vitest --run",
    "test:py": "cd photos && . process_photos/.venv/bin/activate && PYTHONPATH=. pytest process_photos/tests",
    "test": "npm-run-all --parallel test:js test:php test:py",
    "document:php": "phpdoc -d ___structure -t _docs/php",
    "document:sass": "sassdoc __styles -d _docs/sass",
    "document:ts": "npx typedoc __scripts/scripts.ts --out _docs/ts",
    "document": "npm run document:sass && npm run document:ts && npm run document:php",
    "deploy:stage:code": "ssh goat \"cd ~/dev.geekofalltrades.org && git pull origin main\"",
    "deploy:stage:photos": "rsync -azh --progress --partial --delete --exclude 'process_photos/' photos/ goat:~/dev.geekofalltrades.org/photos/",
    "deploy:stage": "npm run deploy:stage:code && npm run deploy:stage:photos",
    "deploy:prod:health": "curl -fsS --max-time 10 https://geekofalltrades.org/ | perl -0777 -ne 'exit 1 unless /(?=.*<header)(?=.*<h1)(?=.*<nav)(?=.*<main)(?=.*<footer)/s'",
    "deploy:prod:snapshot": "ssh goat \"set -e; TS=\\$(date +%F-%H%M%S); SNAP=\\$HOME/snapshots/\\$TS; SRC=\\$HOME/geekofalltrades.org; mkdir -p \\\"\\$SNAP\\\" && rsync -ah --omit-dir-times --itemize-changes --exclude=.dh-diag --link-dest=\\$SRC \\$SRC/ \\$SNAP/ && ln -sfn \\$SNAP \\$HOME/snapshots/latest\"",
    "deploy:prod:rollback": "ssh goat \"rsync -ah --omit-dir-times --itemize-changes --exclude=.dh-diag --delete ~/snapshots/latest/ ~/geekofalltrades.org/\" | grep -v '^.d'",
    "deploy:prod:clean": "ssh goat \"rsync -ah --omit-dir-times --itemize-changes --exclude=.dh-diag --exclude=.git --exclude=.venv --exclude=node_modules --delete ~/dev.geekofalltrades.org/ ~/geekofalltrades.org/ | grep -v '^.d'; exit \\${PIPESTATUS[0]}\"",
    "deploy:prod:update": "ssh goat \"rsync -ah --omit-dir-times --itemize-changes --exclude=.dh-diag --exclude=.git --exclude=.venv --exclude=node_modules ~/dev.geekofalltrades.org/ ~/geekofalltrades.org/ | grep -v '^.d'; exit \\${PIPESTATUS[0]}\"",
    "deploy:prod:legacy": "ssh goat \"rsync -ah --omit-dir-times --itemize-changes --exclude=.dh-diag --ignore-existing --exclude='/___structure/' ~/old.geekofalltrades.org/ ~/geekofalltrades.org/ | grep -v '^.d'; exit \\${PIPESTATUS[0]}\"",
    "deploy:prod": "npm run deploy:prod:health && npm run deploy:prod:snapshot && npm run deploy:prod:update && npm run deploy:prod:health && npm run deploy:prod:legacy && npm run deploy:prod:health && echo 'Deploy OK' || (echo 'Deploy FAILED â€” rolling back' && npm run deploy:prod:rollback)"
  }
}
